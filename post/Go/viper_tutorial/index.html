<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Go语言配置管理神器——Viper中文教程 | 魏奇的博客</title>
    <meta property="og:title" content="Go语言配置管理神器——Viper中文教程 - 魏奇的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-05-21T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-05-21T00:00:00&#43;08:00'>
        
    <meta name="Keywords" content="golang,go语言,go语言笔记,java,android,博客,项目管理,python,软件架构,公众号,小程序">
    <meta name="description" content="Go语言配置管理神器——Viper中文教程">
        
    <meta name="author" content="魏奇">
    <meta property="og:url" content="https://blog.imw7.com/post/Go/viper_tutorial/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
        <link rel="stylesheet" href='/css/douban.css'>
    
        <link rel="stylesheet" href='/css/other.css'>
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://blog.imw7.com/">
                        魏奇的博客
                    </a>
                
                <p class="description">海阔凭鱼跃，天高任鸟飞</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://blog.imw7.com/">首页</a>
                    
                    <a  href="https://blog.imw7.com/archives/" title="归档">归档</a>
                    
                    <a  href="https://blog.imw7.com/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        margin-right: 0px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 45%;
        overflow-y: auto;
        overflow-x: hidden;
        float: right;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 18px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 12px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 8px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 10px;
        list-style: none;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul ul ul ul {
        margin-right: 10px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="top: 280px; right: 0px; float: right;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#安装">安装</a></li>
    <li><a href="#什么是viper">什么是Viper？</a></li>
    <li><a href="#为什么选择viper">为什么选择Viper?</a></li>
    <li><a href="#把值存入viper">把值存入Viper</a>
      <ul>
        <li><a href="#建立默认值">建立默认值</a></li>
        <li><a href="#读取配置文件">读取配置文件</a></li>
        <li><a href="#写入配置文件">写入配置文件</a></li>
        <li><a href="#监控并重新读取配置文件">监控并重新读取配置文件</a></li>
        <li><a href="#从ioreader读取配置">从io.Reader读取配置</a></li>
        <li><a href="#覆盖设置">覆盖设置</a></li>
        <li><a href="#注册和使用别名">注册和使用别名</a></li>
        <li><a href="#使用环境变量">使用环境变量</a></li>
        <li><a href="#使用flags">使用Flags</a></li>
        <li><a href="#远程keyvalue存储支持">远程Key/Value存储支持</a></li>
        <li><a href="#远程keyvalue存储示例-未加密">远程Key/Value存储示例-未加密</a></li>
        <li><a href="#远程keyvalue存储示例-加密">远程Key/Value存储示例-加密</a></li>
        <li><a href="#监控etcd中的更改-未加密">监控etcd中的更改-未加密</a></li>
      </ul>
    </li>
    <li><a href="#从viper获取值">从Viper获取值</a>
      <ul>
        <li><a href="#访问嵌套的键">访问嵌套的键</a></li>
        <li><a href="#提取子树">提取子树</a></li>
        <li><a href="#反序列化">反序列化</a></li>
        <li><a href="#序列化成字符串">序列化成字符串</a></li>
      </ul>
    </li>
    <li><a href="#使用单个还是多个viper实例">使用单个还是多个Viper实例?</a>
      <ul>
        <li><a href="#使用多个viper实例">使用多个viper实例</a></li>
      </ul>
    </li>
    <li><a href="#使用viper示例">使用Viper示例</a>
      <ul>
        <li><a href="#直接使用viper管理配置">直接使用viper管理配置</a></li>
        <li><a href="#使用结构体变量保存配置信息">使用结构体变量保存配置信息</a></li>
      </ul>
    </li>
    <li><a href="#参考链接">参考链接</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var rightPos = window.screenX+$("#main").offset().left;
            if(rightPos<220){
                postToc.css({"width":rightPos+10,"margin-right":0})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">Go语言配置管理神器——Viper中文教程</h1>
        </header>
        <date class="post-meta meta-date">
            2020年5月21日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/Go'>Go</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        <div class="post-content">
            <p><a href="https://github.com/spf13/viper">Viper</a>是适用于Go应用程序的完整配置解决方案。它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式。</p>
<h1 id="viper">Viper</h1>
<p><a href="https://github.com/spf13/viper">Viper</a>是适用于Go应用程序的完整配置解决方案。它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式。</p>
<p>鉴于<code>viper</code>库本身的README已经写得十分详细，这里就将其翻译成中文，并在最后附上两个项目中使用<code>viper</code>的示例代码以供参考。</p>
<h2 id="安装">安装</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get github.com/spf13/viper
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="什么是viper">什么是Viper？</h2>
<p>Viper是适用于Go应用程序（包括<code>Twelve-Factor App</code>）的完整配置解决方案。它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式。它支持以下特性：</p>
<ul>
<li>设置默认值</li>
<li>从<code>JSON</code>、<code>TOML</code>、<code>YAML</code>、<code>HCL</code>、<code>envfile</code>和<code>Java properties</code>格式的配置文件读取配置信息</li>
<li>实时监控和重新读取配置文件（可选）</li>
<li>从环境变量中读取</li>
<li>从远程配置系统（etcd或Consul）读取并监控配置变化</li>
<li>从命令行参数读取配置</li>
<li>从buffer读取配置</li>
<li>显式配置值</li>
</ul>
<h2 id="为什么选择viper">为什么选择Viper?</h2>
<p>在构建现代应用程序时，你无需担心配置文件格式；你想要专注于构建出色的软件。Viper的出现就是为了在这方面帮助你的。</p>
<p>Viper能够为你执行下列操作：</p>
<ol>
<li>查找、加载和反序列化<code>JSON</code>、<code>TOML</code>、<code>YAML</code>、<code>HCL</code>、<code>INI</code>、<code>envfile</code>和<code>Java properties</code>格式的配置文件。</li>
<li>提供一种机制为你的不同配置选项设置默认值。</li>
<li>提供一种机制来通过命令行参数覆盖指定选项的值。</li>
<li>提供别名系统，以便在不破坏现有代码的情况下轻松重命名参数。</li>
<li>当用户提供了与默认值相同的命令行或配置文件时，可以很容易地分辨出它们之间的区别。</li>
</ol>
<p>Viper会按照下面的优先级。每个项目的优先级都高于它下面的项目:</p>
<ul>
<li>显示调用<code>Set</code>设置值</li>
<li>命令行参数（flag）</li>
<li>环境变量</li>
<li>配置文件</li>
<li>key/value存储</li>
<li>默认值</li>
</ul>
<p><strong>重要：</strong> 目前Viper配置的键（Key）是大小写不敏感的。目前正在讨论是否将这一选项设为可选。</p>
<h2 id="把值存入viper">把值存入Viper</h2>
<h3 id="建立默认值">建立默认值</h3>
<p>一个好的配置系统应该支持默认值。键不需要默认值，但如果没有通过配置文件、环境变量、远程配置或命令行标志（flag）设置键，则默认值非常有用。</p>
<p>例如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetDefault</span>(<span style="color:#666;font-style:italic">&#34;ContentDir&#34;</span>, <span style="color:#666;font-style:italic">&#34;content&#34;</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetDefault</span>(<span style="color:#666;font-style:italic">&#34;LayoutDir&#34;</span>, <span style="color:#666;font-style:italic">&#34;layouts&#34;</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetDefault</span>(<span style="color:#666;font-style:italic">&#34;Taxonomies&#34;</span>, <span style="font-weight:bold;font-style:italic">map</span>[<span style="font-weight:bold">string</span>]<span style="font-weight:bold">string</span>{<span style="color:#666;font-style:italic">&#34;tag&#34;</span>: <span style="color:#666;font-style:italic">&#34;tags&#34;</span>, <span style="color:#666;font-style:italic">&#34;category&#34;</span>: <span style="color:#666;font-style:italic">&#34;categories&#34;</span>})
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="读取配置文件">读取配置文件</h3>
<p>Viper需要最少知道在哪里查找配置文件的配置。Viper支持<code>JSON</code>、<code>TOML</code>、<code>YAML</code>、<code>HCL</code>、<code>envfile</code>和<code>Java properties</code>格式的配置文件。Viper可以搜索多个路径，但目前单个Viper实例只支持单个配置文件。Viper不默认任何配置搜索路径，将默认决策留给应用程序。</p>
<p>下面是一个如何使用Viper搜索和读取配置文件的示例。不需要任何特定的路径，但是至少应该提供一个配置文件预期出现的路径。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigFile</span>(<span style="color:#666;font-style:italic">&#34;./config.yaml&#34;</span>) <span style="color:#888;font-style:italic">// 指定配置文件路径
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigName</span>(<span style="color:#666;font-style:italic">&#34;config&#34;</span>) <span style="color:#888;font-style:italic">// 配置文件名称(无扩展名)
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigType</span>(<span style="color:#666;font-style:italic">&#34;yaml&#34;</span>) <span style="color:#888;font-style:italic">// 如果配置文件的名称中没有扩展名，则需要配置此项
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">AddConfigPath</span>(<span style="color:#666;font-style:italic">&#34;/etc/appname/&#34;</span>)   <span style="color:#888;font-style:italic">// 查找配置文件所在的路径
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">AddConfigPath</span>(<span style="color:#666;font-style:italic">&#34;$HOME/.appname&#34;</span>)  <span style="color:#888;font-style:italic">// 多次调用以添加多个搜索路径
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">AddConfigPath</span>(<span style="color:#666;font-style:italic">&#34;.&#34;</span>)               <span style="color:#888;font-style:italic">// 还可以在工作目录中查找配置
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>err := viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadInConfig</span>() <span style="color:#888;font-style:italic">// 查找并读取配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="font-weight:bold">if</span> err != <span style="font-weight:bold">nil</span> { <span style="color:#888;font-style:italic">// 处理读取配置文件的错误
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	<span style="font-weight:bold;font-style:italic">panic</span>(fmt.<span style="color:#666;font-weight:bold;font-style:italic">Errorf</span>(<span style="color:#666;font-style:italic">&#34;Fatal error config file: %s \n&#34;</span>, err))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在加载配置文件出错时，你可以像下面这样处理找不到配置文件的特定情况：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold">if</span> err := viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadInConfig</span>(); err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span> _, ok := err.(viper.ConfigFileNotFoundError); ok {
</span></span><span style="display:flex;"><span>        <span style="color:#888;font-style:italic">// 配置文件未找到错误；如果需要可以忽略
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>    } <span style="font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#888;font-style:italic">// 配置文件被找到，但产生了另外的错误
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">// 配置文件找到并成功解析
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><em>注意[自1.6起]：</em> 你也可以有不带扩展名的文件，并以编程方式指定其格式。对于位于用户<code>$HOME</code>目录中的配置文件没有任何扩展名，如<code>.bashrc</code>。</p>
<p><strong>这里补充两个问题供读者解答并自行验证</strong></p>
<p>当你使用如下方式读取配置时，viper会从<code>./conf</code>目录下查找任何以<code>config</code>为文件名的配置文件，如果同时存在<code>./conf/config.json</code>和<code>./conf/config.yaml</code>两个配置文件的话，<code>viper</code>会从哪个配置文件加载配置呢？</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigName</span>(<span style="color:#666;font-style:italic">&#34;config&#34;</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">AddConfigPath</span>(<span style="color:#666;font-style:italic">&#34;./conf&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>在上面两个语句下搭配使用<code>viper.SetConfigType(&quot;yaml&quot;)</code>指定配置文件类型可以实现预期的效果吗？</p>
<h3 id="写入配置文件">写入配置文件</h3>
<p>从配置文件中读取配置文件是有用的，但是有时你想要存储在运行时所做的所有修改。为此，可以使用下面一组命令，每个命令都有自己的用途:</p>
<ul>
<li>WriteConfig - 将当前的<code>viper</code>配置写入预定义的路径并覆盖（如果存在的话）。如果没有预定义的路径，则报错。</li>
<li>SafeWriteConfig - 将当前的<code>viper</code>配置写入预定义的路径。如果没有预定义的路径，则报错。如果存在，将不会覆盖当前的配置文件。</li>
<li>WriteConfigAs - 将当前的<code>viper</code>配置写入给定的文件路径。将覆盖给定的文件(如果它存在的话)。</li>
<li>SafeWriteConfigAs - 将当前的<code>viper</code>配置写入给定的文件路径。不会覆盖给定的文件(如果它存在的话)。</li>
</ul>
<p>根据经验，标记为<code>safe</code>的所有方法都不会覆盖任何文件，而是直接创建（如果不存在），而默认行为是创建或截断。</p>
<p>一个小示例：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">WriteConfig</span>() <span style="color:#888;font-style:italic">// 将当前配置写入“viper.AddConfigPath()”和“viper.SetConfigName”设置的预定义路径
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SafeWriteConfig</span>()
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">WriteConfigAs</span>(<span style="color:#666;font-style:italic">&#34;/path/to/my/.config&#34;</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SafeWriteConfigAs</span>(<span style="color:#666;font-style:italic">&#34;/path/to/my/.config&#34;</span>) <span style="color:#888;font-style:italic">// 因为该配置文件写入过，所以会报错
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SafeWriteConfigAs</span>(<span style="color:#666;font-style:italic">&#34;/path/to/my/.other_config&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="监控并重新读取配置文件">监控并重新读取配置文件</h3>
<p>Viper支持在运行时实时读取配置文件的功能。</p>
<p>需要重新启动服务器以使配置生效的日子已经一去不复返了，viper驱动的应用程序可以在运行时读取配置文件的更新，而不会错过任何消息。</p>
<p>只需告诉viper实例watchConfig。可选地，你可以为Viper提供一个回调函数，以便在每次发生更改时运行。</p>
<p><strong>确保在调用<code>WatchConfig()</code>之前添加了所有的配置路径。</strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">WatchConfig</span>()
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">OnConfigChange</span>(<span style="font-weight:bold;font-style:italic">func</span>(e fsnotify.Event) {
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic">// 配置文件发生变更之后会调用的回调函数
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	fmt.<span style="color:#666;font-weight:bold;font-style:italic">Println</span>(<span style="color:#666;font-style:italic">&#34;Config file changed:&#34;</span>, e.Name)
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="从ioreader读取配置">从io.Reader读取配置</h3>
<p>Viper预先定义了许多配置源，如文件、环境变量、标志和远程K/V存储，但你不受其约束。你还可以实现自己所需的配置源并将其提供给viper。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigType</span>(<span style="color:#666;font-style:italic">&#34;yaml&#34;</span>) <span style="color:#888;font-style:italic">// 或者 viper.SetConfigType(&#34;YAML&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">// 任何需要将此配置添加到程序中的方法。
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="font-weight:bold;font-style:italic">var</span> yamlExample = []<span style="font-weight:bold;font-style:italic">byte</span>(<span style="color:#666;font-style:italic">`
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">Hacker: true
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">name: steve
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">hobbies:
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">- skateboarding
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">- snowboarding
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">- go
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">clothing:
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">  jacket: leather
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">  trousers: denim
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">age: 35
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">eyes : brown
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">beard: true
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">`</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadConfig</span>(bytes.<span style="color:#666;font-weight:bold;font-style:italic">NewBuffer</span>(yamlExample))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">Get</span>(<span style="color:#666;font-style:italic">&#34;name&#34;</span>) <span style="color:#888;font-style:italic">// 这里会得到 &#34;steve&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="覆盖设置">覆盖设置</h3>
<p>这些可能来自命令行标志，也可能来自你自己的应用程序逻辑。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">Set</span>(<span style="color:#666;font-style:italic">&#34;Verbose&#34;</span>, <span style="font-weight:bold">true</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">Set</span>(<span style="color:#666;font-style:italic">&#34;LogFile&#34;</span>, LogFile)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="注册和使用别名">注册和使用别名</h3>
<p>别名允许多个键引用单个值</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">RegisterAlias</span>(<span style="color:#666;font-style:italic">&#34;loud&#34;</span>, <span style="color:#666;font-style:italic">&#34;Verbose&#34;</span>)  <span style="color:#888;font-style:italic">// 注册别名（此处loud和Verbose建立了别名）
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">Set</span>(<span style="color:#666;font-style:italic">&#34;verbose&#34;</span>, <span style="font-weight:bold">true</span>) <span style="color:#888;font-style:italic">// 结果与下一行相同
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">Set</span>(<span style="color:#666;font-style:italic">&#34;loud&#34;</span>, <span style="font-weight:bold">true</span>)   <span style="color:#888;font-style:italic">// 结果与前一行相同
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">GetBool</span>(<span style="color:#666;font-style:italic">&#34;loud&#34;</span>) <span style="color:#888;font-style:italic">// true
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>viper.<span style="color:#666;font-weight:bold;font-style:italic">GetBool</span>(<span style="color:#666;font-style:italic">&#34;verbose&#34;</span>) <span style="color:#888;font-style:italic">// true
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用环境变量">使用环境变量</h3>
<p>Viper完全支持环境变量。这使<code>Twelve-Factor App</code>开箱即用。有五种方法可以帮助与ENV协作:</p>
<ul>
<li><code>AutomaticEnv()</code></li>
<li><code>BindEnv(string...) : error</code></li>
<li><code>SetEnvPrefix(string)</code></li>
<li><code>SetEnvKeyReplacer(string...) *strings.Replacer</code></li>
<li><code>AllowEmptyEnv(bool)</code></li>
</ul>
<p><em>使用ENV变量时，务必要意识到Viper将ENV变量视为区分大小写。</em></p>
<p>Viper提供了一种机制来确保ENV变量是惟一的。通过使用<code>SetEnvPrefix</code>，你可以告诉Viper在读取环境变量时使用前缀。<code>BindEnv</code>和<code>AutomaticEnv</code>都将使用这个前缀。</p>
<p><code>BindEnv</code>使用一个或两个参数。第一个参数是键名称，第二个是环境变量的名称。环境变量的名称区分大小写。如果没有提供ENV变量名，那么Viper将自动假设ENV变量与以下格式匹配：前缀+ “_” +键名全部大写。当你显式提供ENV变量名（第二个参数）时，它 <strong>不会</strong> 自动添加前缀。例如，如果第二个参数是“id”，Viper将查找环境变量“ID”。</p>
<p>在使用ENV变量时，需要注意的一件重要事情是，每次访问该值时都将读取它。Viper在调用<code>BindEnv</code>时不固定该值。</p>
<p><code>AutomaticEnv</code>是一个强大的助手，尤其是与<code>SetEnvPrefix</code>结合使用时。调用时，Viper会在发出<code>viper.Get</code>请求时随时检查环境变量。它将应用以下规则。它将检查环境变量的名称是否与键匹配（如果设置了<code>EnvPrefix</code>）。</p>
<p><code>SetEnvKeyReplacer</code>允许你使用<code>strings.Replacer</code>对象在一定程度上重写 Env 键。如果你希望在<code>Get()</code>调用中使用<code>-</code>或者其他什么符号，但是环境变量里使用<code>_</code>分隔符，那么这个功能是非常有用的。可以在<code>viper_test.go</code>中找到它的使用示例。</p>
<p>或者，你可以使用带有<code>NewWithOptions</code>工厂函数的<code>EnvKeyReplacer</code>。与<code>SetEnvKeyReplacer</code>不同，它接受<code>StringReplacer</code>接口，允许你编写自定义字符串替换逻辑。</p>
<p>默认情况下，空环境变量被认为是未设置的，并将返回到下一个配置源。若要将空环境变量视为已设置，请使用<code>AllowEmptyEnv</code>方法。</p>
<h4 id="env-示例">Env 示例：</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#666;font-weight:bold;font-style:italic">SetEnvPrefix</span>(<span style="color:#666;font-style:italic">&#34;spf&#34;</span>) <span style="color:#888;font-style:italic">// 将自动转为大写
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="color:#666;font-weight:bold;font-style:italic">BindEnv</span>(<span style="color:#666;font-style:italic">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>os.<span style="color:#666;font-weight:bold;font-style:italic">Setenv</span>(<span style="color:#666;font-style:italic">&#34;SPF_ID&#34;</span>, <span style="color:#666;font-style:italic">&#34;13&#34;</span>) <span style="color:#888;font-style:italic">// 通常是在应用程序之外完成的
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>
</span></span><span style="display:flex;"><span>id := <span style="color:#666;font-weight:bold;font-style:italic">Get</span>(<span style="color:#666;font-style:italic">&#34;id&#34;</span>) <span style="color:#888;font-style:italic">// 13
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用flags">使用Flags</h3>
<p>Viper 具有绑定到标志的能力。具体来说，Viper支持<a href="https://github.com/spf13/cobra">Cobra</a>库中使用的<code>Pflag</code>。</p>
<p>与<code>BindEnv</code>类似，该值不是在调用绑定方法时设置的，而是在访问该方法时设置的。这意味着你可以根据需要尽早进行绑定，即使在<code>init()</code>函数中也是如此。</p>
<p>对于单个标志，<code>BindPFlag()</code>方法提供此功能。</p>
<p>例如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>serverCmd.<span style="color:#666;font-weight:bold;font-style:italic">Flags</span>().<span style="color:#666;font-weight:bold;font-style:italic">Int</span>(<span style="color:#666;font-style:italic">&#34;port&#34;</span>, 1138, <span style="color:#666;font-style:italic">&#34;Port to run Application server on&#34;</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">BindPFlag</span>(<span style="color:#666;font-style:italic">&#34;port&#34;</span>, serverCmd.<span style="color:#666;font-weight:bold;font-style:italic">Flags</span>().<span style="color:#666;font-weight:bold;font-style:italic">Lookup</span>(<span style="color:#666;font-style:italic">&#34;port&#34;</span>))
</span></span></code></pre></td></tr></table>
</div>
</div><p>你还可以绑定一组现有的pflags （pflag.FlagSet）：</p>
<p>举个例子：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>pflag.<span style="color:#666;font-weight:bold;font-style:italic">Int</span>(<span style="color:#666;font-style:italic">&#34;flagname&#34;</span>, 1234, <span style="color:#666;font-style:italic">&#34;help message for flagname&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pflag.<span style="color:#666;font-weight:bold;font-style:italic">Parse</span>()
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">BindPFlags</span>(pflag.CommandLine)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>i := viper.<span style="color:#666;font-weight:bold;font-style:italic">GetInt</span>(<span style="color:#666;font-style:italic">&#34;flagname&#34;</span>) <span style="color:#888;font-style:italic">// 从viper而不是从pflag检索值
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在 Viper 中使用 pflag 并不阻碍其他包中使用标准库中的 flag 包。pflag 包可以通过导入这些 flags 来处理flag包定义的flags。这是通过调用pflag包提供的便利函数<code>AddGoFlagSet()</code>来实现的。</p>
<p>例如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;github.com/spf13/pflag&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> <span style="color:#666;font-weight:bold;font-style:italic">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#888;font-style:italic">// 使用标准库 &#34;flag&#34; 包
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	flag.<span style="color:#666;font-weight:bold;font-style:italic">Int</span>(<span style="color:#666;font-style:italic">&#34;flagname&#34;</span>, 1234, <span style="color:#666;font-style:italic">&#34;help message for flagname&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	pflag.CommandLine.<span style="color:#666;font-weight:bold;font-style:italic">AddGoFlagSet</span>(flag.CommandLine)
</span></span><span style="display:flex;"><span>	pflag.<span style="color:#666;font-weight:bold;font-style:italic">Parse</span>()
</span></span><span style="display:flex;"><span>	viper.<span style="color:#666;font-weight:bold;font-style:italic">BindPFlags</span>(pflag.CommandLine)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	i := viper.<span style="color:#666;font-weight:bold;font-style:italic">GetInt</span>(<span style="color:#666;font-style:italic">&#34;flagname&#34;</span>) <span style="color:#888;font-style:italic">// 从 viper 检索值
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>
</span></span><span style="display:flex;"><span>	...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="flag接口">flag接口</h4>
<p>如果你不使用<code>Pflag</code>，Viper 提供了两个Go接口来绑定其他 flag 系统。</p>
<p><code>FlagValue</code>表示单个flag。这是一个关于如何实现这个接口的非常简单的例子：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">type</span> myFlag <span style="font-weight:bold;font-style:italic">struct</span> {}
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> (f myFlag) <span style="color:#666;font-weight:bold;font-style:italic">HasChanged</span>() <span style="font-weight:bold">bool</span> { <span style="font-weight:bold">return</span> <span style="font-weight:bold">false</span> }
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> (f myFlag) <span style="color:#666;font-weight:bold;font-style:italic">Name</span>() <span style="font-weight:bold">string</span> { <span style="font-weight:bold">return</span> <span style="color:#666;font-style:italic">&#34;my-flag-name&#34;</span> }
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> (f myFlag) <span style="color:#666;font-weight:bold;font-style:italic">ValueString</span>() <span style="font-weight:bold">string</span> { <span style="font-weight:bold">return</span> <span style="color:#666;font-style:italic">&#34;my-flag-value&#34;</span> }
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> (f myFlag) <span style="color:#666;font-weight:bold;font-style:italic">ValueType</span>() <span style="font-weight:bold">string</span> { <span style="font-weight:bold">return</span> <span style="color:#666;font-style:italic">&#34;string&#34;</span> }
</span></span></code></pre></td></tr></table>
</div>
</div><p>一旦你的 flag 实现了这个接口，你可以很方便地告诉Viper绑定它：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">BindFlagValue</span>(<span style="color:#666;font-style:italic">&#34;my-flag-name&#34;</span>, myFlag{})
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>FlagValueSet</code>代表一组 flags 。这是一个关于如何实现这个接口的非常简单的例子:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">type</span> myFlagSet <span style="font-weight:bold;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>	flags []myFlag
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> (f myFlagSet) <span style="color:#666;font-weight:bold;font-style:italic">VisitAll</span>(fn <span style="font-weight:bold;font-style:italic">func</span>(FlagValue)) {
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">for</span> _, flag := <span style="font-weight:bold">range</span> flags {
</span></span><span style="display:flex;"><span>		<span style="color:#666;font-weight:bold;font-style:italic">fn</span>(flag)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>一旦你的flag set实现了这个接口，你就可以很方便地告诉Viper绑定它：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>fSet := myFlagSet{
</span></span><span style="display:flex;"><span>	flags: []myFlag{myFlag{}, myFlag{}},
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">BindFlagValues</span>(<span style="color:#666;font-style:italic">&#34;my-flags&#34;</span>, fSet)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="远程keyvalue存储支持">远程Key/Value存储支持</h3>
<p>在Viper中启用远程支持，需要在代码中匿名导入<code>viper/remote</code>这个包。</p>
<pre tabindex="0"><code>import _ &#34;github.com/spf13/viper/remote&#34;
</code></pre><p>Viper将读取从Key/Value存储（例如etcd或Consul）中的路径检索到的配置字符串（如<code>JSON</code>、<code>TOML</code>、<code>YAML</code>、<code>HCL</code>、<code>envfile</code>和<code>Java properties</code>格式）。这些值的优先级高于默认值，但是会被从磁盘、flag或环境变量检索到的配置值覆盖。（译注：也就是说Viper加载配置值的优先级为：磁盘上的配置文件&gt;命令行标志位&gt;环境变量&gt;远程Key/Value存储&gt;默认值。）</p>
<p>Viper使用<a href="https://github.com/bketelsen/crypt">crypt</a>从K/V存储中检索配置，这意味着如果你有正确的gpg密匙，你可以将配置值加密存储并自动解密。加密是可选的。</p>
<p>你可以将远程配置与本地配置结合使用，也可以独立使用。</p>
<p><code>crypt</code>有一个命令行助手，你可以使用它将配置放入K/V存储中。<code>crypt</code>默认使用在<a href="http://127.0.0.1:4001/">http://127.0.0.1:4001</a>的etcd。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ go get github.com/bketelsen/crypt/bin/crypt
</span></span><span style="display:flex;"><span>$ crypt <span style="font-weight:bold;font-style:italic">set</span> -plaintext /config/hugo.json /Users/hugo/settings/config.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>确认值已经设置：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ crypt get -plaintext /config/hugo.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>有关如何设置加密值或如何使用Consul的示例，请参见<code>crypt</code>文档。</p>
<h3 id="远程keyvalue存储示例-未加密">远程Key/Value存储示例-未加密</h3>
<h4 id="etcd">etcd</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">AddRemoteProvider</span>(<span style="color:#666;font-style:italic">&#34;etcd&#34;</span>, <span style="color:#666;font-style:italic">&#34;http://127.0.0.1:4001&#34;</span>,<span style="color:#666;font-style:italic">&#34;/config/hugo.json&#34;</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigType</span>(<span style="color:#666;font-style:italic">&#34;json&#34;</span>) <span style="color:#888;font-style:italic">// 因为在字节流中没有文件扩展名，所以这里需要设置下类型。支持的扩展名有 &#34;json&#34;, &#34;toml&#34;, &#34;yaml&#34;, &#34;yml&#34;, &#34;properties&#34;, &#34;props&#34;, &#34;prop&#34;, &#34;env&#34;, &#34;dotenv&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>err := viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadRemoteConfig</span>()
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="consul">Consul</h4>
<p>你需要 Consul Key/Value存储中设置一个Key保存包含所需配置的JSON值。例如，创建一个key<code>MY_CONSUL_KEY</code>将下面的值存入Consul key/value 存储：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;port&#34;: 8080,
</span></span><span style="display:flex;"><span>    &#34;hostname&#34;: <span style="color:#666;font-style:italic">&#34;liwenzhou.com&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="">viper.AddRemoteProvider(</span><span style="color:#666;font-style:italic">&#34;consul&#34;</span><span style="">,</span> <span style="color:#666;font-style:italic">&#34;localhost:8500&#34;</span><span style="">,</span> <span style="color:#666;font-style:italic">&#34;MY_CONSUL_KEY&#34;</span><span style="">)</span>
</span></span><span style="display:flex;"><span><span style="">viper.SetConfigType(</span><span style="color:#666;font-style:italic">&#34;json&#34;</span><span style="">)</span> <span style="color:#888;font-style:italic">// 需要显示设置成json
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="">err</span> <span style="">:=</span> <span style="">viper.ReadRemoteConfig()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">fmt.Println(viper.Get(</span><span style="color:#666;font-style:italic">&#34;port&#34;</span><span style="">))</span> <span style="color:#888;font-style:italic">// 8080
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="">fmt.Println(viper.Get(</span><span style="color:#666;font-style:italic">&#34;hostname&#34;</span><span style="">))</span> <span style="color:#888;font-style:italic">// liwenzhou.com
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="firestore">Firestore</h4>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">AddRemoteProvider</span>(<span style="color:#666;font-style:italic">&#34;firestore&#34;</span>, <span style="color:#666;font-style:italic">&#34;google-cloud-project-id&#34;</span>, <span style="color:#666;font-style:italic">&#34;collection/document&#34;</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigType</span>(<span style="color:#666;font-style:italic">&#34;json&#34;</span>) <span style="color:#888;font-style:italic">// 配置的格式: &#34;json&#34;, &#34;toml&#34;, &#34;yaml&#34;, &#34;yml&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>err := viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadRemoteConfig</span>()
</span></span></code></pre></td></tr></table>
</div>
</div><p>当然，你也可以使用<code>SecureRemoteProvider</code>。</p>
<h3 id="远程keyvalue存储示例-加密">远程Key/Value存储示例-加密</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">AddSecureRemoteProvider</span>(<span style="color:#666;font-style:italic">&#34;etcd&#34;</span>,<span style="color:#666;font-style:italic">&#34;http://127.0.0.1:4001&#34;</span>,<span style="color:#666;font-style:italic">&#34;/config/hugo.json&#34;</span>,<span style="color:#666;font-style:italic">&#34;/etc/secrets/mykeyring.gpg&#34;</span>)
</span></span><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigType</span>(<span style="color:#666;font-style:italic">&#34;json&#34;</span>) <span style="color:#888;font-style:italic">// 因为在字节流中没有文件扩展名，所以这里需要设置下类型。支持的扩展名有 &#34;json&#34;, &#34;toml&#34;, &#34;yaml&#34;, &#34;yml&#34;, &#34;properties&#34;, &#34;props&#34;, &#34;prop&#34;, &#34;env&#34;, &#34;dotenv&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>err := viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadRemoteConfig</span>()
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="监控etcd中的更改-未加密">监控etcd中的更改-未加密</h3>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#888;font-style:italic">// 或者你可以创建一个新的viper实例
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="font-weight:bold;font-style:italic">var</span> runtime_viper = viper.<span style="color:#666;font-weight:bold;font-style:italic">New</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>runtime_viper.<span style="color:#666;font-weight:bold;font-style:italic">AddRemoteProvider</span>(<span style="color:#666;font-style:italic">&#34;etcd&#34;</span>, <span style="color:#666;font-style:italic">&#34;http://127.0.0.1:4001&#34;</span>, <span style="color:#666;font-style:italic">&#34;/config/hugo.yml&#34;</span>)
</span></span><span style="display:flex;"><span>runtime_viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigType</span>(<span style="color:#666;font-style:italic">&#34;yaml&#34;</span>) <span style="color:#888;font-style:italic">// 因为在字节流中没有文件扩展名，所以这里需要设置下类型。支持的扩展名有 &#34;json&#34;, &#34;toml&#34;, &#34;yaml&#34;, &#34;yml&#34;, &#34;properties&#34;, &#34;props&#34;, &#34;prop&#34;, &#34;env&#34;, &#34;dotenv&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">// 第一次从远程读取配置
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>err := runtime_viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadRemoteConfig</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">// 反序列化
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>runtime_viper.<span style="color:#666;font-weight:bold;font-style:italic">Unmarshal</span>(&amp;runtime_conf)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">// 开启一个单独的goroutine一直监控远端的变更
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="font-weight:bold">go</span> <span style="font-weight:bold;font-style:italic">func</span>(){
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">for</span> {
</span></span><span style="display:flex;"><span>	    time.<span style="color:#666;font-weight:bold;font-style:italic">Sleep</span>(time.Second * 5) <span style="color:#888;font-style:italic">// 每次请求后延迟一下
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>
</span></span><span style="display:flex;"><span>	    <span style="color:#888;font-style:italic">// 目前只测试了etcd支持
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	    err := runtime_viper.<span style="color:#666;font-weight:bold;font-style:italic">WatchRemoteConfig</span>()
</span></span><span style="display:flex;"><span>	    <span style="font-weight:bold">if</span> err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>	        log.<span style="color:#666;font-weight:bold;font-style:italic">Errorf</span>(<span style="color:#666;font-style:italic">&#34;unable to read remote config: %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>	        <span style="font-weight:bold">continue</span>
</span></span><span style="display:flex;"><span>	    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	    <span style="color:#888;font-style:italic">// 将新配置反序列化到我们运行时的配置结构体中。你还可以借助channel实现一个通知系统更改的信号
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	    runtime_viper.<span style="color:#666;font-weight:bold;font-style:italic">Unmarshal</span>(&amp;runtime_conf)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}()
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="从viper获取值">从Viper获取值</h2>
<p>在Viper中，有几种方法可以根据值的类型获取值。存在以下功能和方法:</p>
<ul>
<li><code>Get(key string) : interface{}</code></li>
<li><code>GetBool(key string) : bool</code></li>
<li><code>GetFloat64(key string) : float64</code></li>
<li><code>GetInt(key string) : int</code></li>
<li><code>GetIntSlice(key string) : []int</code></li>
<li><code>GetString(key string) : string</code></li>
<li><code>GetStringMap(key string) : map[string]interface{}</code></li>
<li><code>GetStringMapString(key string) : map[string]string</code></li>
<li><code>GetStringSlice(key string) : []string</code></li>
<li><code>GetTime(key string) : time.Time</code></li>
<li><code>GetDuration(key string) : time.Duration</code></li>
<li><code>IsSet(key string) : bool</code></li>
<li><code>AllSettings() : map[string]interface{}</code></li>
</ul>
<p>需要认识到的一件重要事情是，每一个Get方法在找不到值的时候都会返回零值。为了检查给定的键是否存在，提供了<code>IsSet()</code>方法。</p>
<p>例如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>viper.<span style="color:#666;font-weight:bold;font-style:italic">GetString</span>(<span style="color:#666;font-style:italic">&#34;logfile&#34;</span>) <span style="color:#888;font-style:italic">// 不区分大小写的设置和获取
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="font-weight:bold">if</span> viper.<span style="color:#666;font-weight:bold;font-style:italic">GetBool</span>(<span style="color:#666;font-style:italic">&#34;verbose&#34;</span>) {
</span></span><span style="display:flex;"><span>    fmt.<span style="color:#666;font-weight:bold;font-style:italic">Println</span>(<span style="color:#666;font-style:italic">&#34;verbose enabled&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="访问嵌套的键">访问嵌套的键</h3>
<p>访问器方法也接受深度嵌套键的格式化路径。例如，如果加载下面的JSON文件：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;host&#34;: {
</span></span><span style="display:flex;"><span>        &#34;address&#34;: <span style="color:#666;font-style:italic">&#34;localhost&#34;</span>,
</span></span><span style="display:flex;"><span>        &#34;port&#34;: 5799
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    &#34;datastore&#34;: {
</span></span><span style="display:flex;"><span>        &#34;metric&#34;: {
</span></span><span style="display:flex;"><span>            &#34;host&#34;: <span style="color:#666;font-style:italic">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;port&#34;: 3099
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;warehouse&#34;: {
</span></span><span style="display:flex;"><span>            &#34;host&#34;: <span style="color:#666;font-style:italic">&#34;198.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;port&#34;: 2112
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Viper可以通过传入<code>.</code>分隔的路径来访问嵌套字段：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#666;font-weight:bold;font-style:italic">GetString</span>(<span style="color:#666;font-style:italic">&#34;datastore.metric.host&#34;</span>) <span style="color:#888;font-style:italic">// (返回 &#34;127.0.0.1&#34;)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这遵守上面建立的优先规则；搜索路径将遍历其余配置注册表，直到找到为止。(译注：因为Viper支持从多种配置来源，例如磁盘上的配置文件&gt;命令行标志位&gt;环境变量&gt;远程Key/Value存储&gt;默认值，我们在查找一个配置的时候如果在当前配置源中没找到，就会继续从后续的配置源查找，直到找到为止。)</p>
<p>例如，在给定此配置文件的情况下，<code>datastore.metric.host</code>和<code>datastore.metric.port</code>均已定义（并且可以被覆盖）。如果另外在默认值中定义了<code>datastore.metric.protocol</code>，Viper也会找到它。</p>
<p>然而，如果<code>datastore.metric</code>被直接赋值覆盖（被flag，环境变量，<code>set()</code>方法等等…），那么<code>datastore.metric</code>的所有子键都将变为未定义状态，它们被高优先级配置级别“遮蔽”（shadowed）了。</p>
<p>最后，如果存在与分隔的键路径匹配的键，则返回其值。例如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#666;font-style:italic">&#34;datastore.metric.host&#34;</span>: <span style="color:#666;font-style:italic">&#34;0.0.0.0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#666;font-style:italic">&#34;host&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#666;font-style:italic">&#34;address&#34;</span>: <span style="color:#666;font-style:italic">&#34;localhost&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#666;font-style:italic">&#34;port&#34;</span>: 5799
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#666;font-style:italic">&#34;datastore&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#666;font-style:italic">&#34;metric&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;host&#34;</span>: <span style="color:#666;font-style:italic">&#34;127.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;port&#34;</span>: 3099
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#666;font-style:italic">&#34;warehouse&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;host&#34;</span>: <span style="color:#666;font-style:italic">&#34;198.0.0.1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;port&#34;</span>: 2112
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#666;font-weight:bold;font-style:italic">GetString</span>(<span style="color:#666;font-style:italic">&#34;datastore.metric.host&#34;</span>) <span style="color:#888;font-style:italic">// 返回 &#34;0.0.0.0&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="提取子树">提取子树</h3>
<p>从Viper中提取子树。</p>
<p>例如，<code>viper</code>实例现在代表了以下配置：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>app:
</span></span><span style="display:flex;"><span>  cache1:
</span></span><span style="display:flex;"><span>    max-items: 100
</span></span><span style="display:flex;"><span>    item-size: 64
</span></span><span style="display:flex;"><span>  cache2:
</span></span><span style="display:flex;"><span>    max-items: 200
</span></span><span style="display:flex;"><span>    item-size: 80
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行后：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>subv := viper.<span style="color:#666;font-weight:bold;font-style:italic">Sub</span>(<span style="color:#666;font-style:italic">&#34;app.cache1&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>subv</code>现在就代表：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>max-items: 100
</span></span><span style="display:flex;"><span>item-size: 64
</span></span></code></pre></td></tr></table>
</div>
</div><p>假设我们现在有这么一个函数：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> <span style="color:#666;font-weight:bold;font-style:italic">NewCache</span>(cfg *Viper) *Cache {...}
</span></span></code></pre></td></tr></table>
</div>
</div><p>它基于<code>subv</code>格式的配置信息创建缓存。现在，可以轻松地分别创建这两个缓存，如下所示：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>cfg1 := viper.<span style="color:#666;font-weight:bold;font-style:italic">Sub</span>(<span style="color:#666;font-style:italic">&#34;app.cache1&#34;</span>)
</span></span><span style="display:flex;"><span>cache1 := <span style="color:#666;font-weight:bold;font-style:italic">NewCache</span>(cfg1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cfg2 := viper.<span style="color:#666;font-weight:bold;font-style:italic">Sub</span>(<span style="color:#666;font-style:italic">&#34;app.cache2&#34;</span>)
</span></span><span style="display:flex;"><span>cache2 := <span style="color:#666;font-weight:bold;font-style:italic">NewCache</span>(cfg2)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="反序列化">反序列化</h3>
<p>你还可以选择将所有或特定的值解析到结构体、map等。</p>
<p>有两种方法可以做到这一点：</p>
<ul>
<li><code>Unmarshal(rawVal interface{}) : error</code></li>
<li><code>UnmarshalKey(key string, rawVal interface{}) : error</code></li>
</ul>
<p>举个例子：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">type</span> config <span style="font-weight:bold;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>	Port <span style="font-weight:bold">int</span>
</span></span><span style="display:flex;"><span>	Name <span style="font-weight:bold">string</span>
</span></span><span style="display:flex;"><span>	PathMap <span style="font-weight:bold">string</span> <span style="color:#666;font-style:italic">`mapstructure:&#34;path_map&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">var</span> C config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>err := viper.<span style="color:#666;font-weight:bold;font-style:italic">Unmarshal</span>(&amp;C)
</span></span><span style="display:flex;"><span><span style="font-weight:bold">if</span> err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>	t.<span style="color:#666;font-weight:bold;font-style:italic">Fatalf</span>(<span style="color:#666;font-style:italic">&#34;unable to decode into struct, %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果你想要解析那些键本身就包含<code>.</code>(默认的键分隔符）的配置，你需要修改分隔符：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>v := viper.<span style="color:#666;font-weight:bold;font-style:italic">NewWithOptions</span>(viper.<span style="color:#666;font-weight:bold;font-style:italic">KeyDelimiter</span>(<span style="color:#666;font-style:italic">&#34;::&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>v.<span style="color:#666;font-weight:bold;font-style:italic">SetDefault</span>(<span style="color:#666;font-style:italic">&#34;chart::values&#34;</span>, <span style="font-weight:bold;font-style:italic">map</span>[<span style="font-weight:bold">string</span>]<span style="font-weight:bold;font-style:italic">interface</span>{}{
</span></span><span style="display:flex;"><span>    <span style="color:#666;font-style:italic">&#34;ingress&#34;</span>: <span style="font-weight:bold;font-style:italic">map</span>[<span style="font-weight:bold">string</span>]<span style="font-weight:bold;font-style:italic">interface</span>{}{
</span></span><span style="display:flex;"><span>        <span style="color:#666;font-style:italic">&#34;annotations&#34;</span>: <span style="font-weight:bold;font-style:italic">map</span>[<span style="font-weight:bold">string</span>]<span style="font-weight:bold;font-style:italic">interface</span>{}{
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;traefik.frontend.rule.type&#34;</span>:                 <span style="color:#666;font-style:italic">&#34;PathPrefix&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;traefik.ingress.kubernetes.io/ssl-redirect&#34;</span>: <span style="color:#666;font-style:italic">&#34;true&#34;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">type</span> config <span style="font-weight:bold;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>	Chart <span style="font-weight:bold;font-style:italic">struct</span>{
</span></span><span style="display:flex;"><span>        Values <span style="font-weight:bold;font-style:italic">map</span>[<span style="font-weight:bold">string</span>]<span style="font-weight:bold;font-style:italic">interface</span>{}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">var</span> C config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>v.<span style="color:#666;font-weight:bold;font-style:italic">Unmarshal</span>(&amp;C)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Viper还支持解析到嵌入的结构体：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#888;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">Example config:
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">module:
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">    enabled: true
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">    token: 89h3f98hbwf987h3f98wenf89ehf
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">type</span> config <span style="font-weight:bold;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>	Module <span style="font-weight:bold;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>		Enabled <span style="font-weight:bold">bool</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		moduleConfig <span style="color:#666;font-style:italic">`mapstructure:&#34;,squash&#34;`</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">// moduleConfig could be in a module specific package
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span><span style="font-weight:bold;font-style:italic">type</span> moduleConfig <span style="font-weight:bold;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>	Token <span style="font-weight:bold">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">var</span> C config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>err := viper.<span style="color:#666;font-weight:bold;font-style:italic">Unmarshal</span>(&amp;C)
</span></span><span style="display:flex;"><span><span style="font-weight:bold">if</span> err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>	t.<span style="color:#666;font-weight:bold;font-style:italic">Fatalf</span>(<span style="color:#666;font-style:italic">&#34;unable to decode into struct, %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Viper在后台使用<a href="https://github.com/mitchellh/mapstructure">github.com/mitchellh/mapstructure</a>来解析值，其默认情况下使用<code>mapstructure</code>tag。</p>
<p><strong>注意</strong> 当我们需要将viper读取的配置反序列到我们定义的结构体变量中时，一定要使用<code>mapstructure</code>tag哦！</p>
<h3 id="序列化成字符串">序列化成字符串</h3>
<p>你可能需要将viper中保存的所有设置序列化到一个字符串中，而不是将它们写入到一个文件中。你可以将自己喜欢的格式的序列化器与<code>AllSettings()</code>返回的配置一起使用。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>    yaml <span style="color:#666;font-style:italic">&#34;gopkg.in/yaml.v2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#888;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> <span style="color:#666;font-weight:bold;font-style:italic">yamlStringSettings</span>() <span style="font-weight:bold">string</span> {
</span></span><span style="display:flex;"><span>    c := viper.<span style="color:#666;font-weight:bold;font-style:italic">AllSettings</span>()
</span></span><span style="display:flex;"><span>    bs, err := yaml.<span style="color:#666;font-weight:bold;font-style:italic">Marshal</span>(c)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span> err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>        log.<span style="color:#666;font-weight:bold;font-style:italic">Fatalf</span>(<span style="color:#666;font-style:italic">&#34;unable to marshal config to YAML: %v&#34;</span>, err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> <span style="font-weight:bold;font-style:italic">string</span>(bs)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="使用单个还是多个viper实例">使用单个还是多个Viper实例?</h2>
<p>Viper是开箱即用的。你不需要配置或初始化即可开始使用Viper。由于大多数应用程序都希望使用单个中央存储库管理它们的配置信息，所以viper包提供了这个功能。它类似于单例模式。</p>
<p>在上面的所有示例中，它们都以其单例风格的方法演示了如何使用viper。</p>
<h3 id="使用多个viper实例">使用多个viper实例</h3>
<p>你还可以在应用程序中创建许多不同的viper实例。每个都有自己独特的一组配置和值。每个人都可以从不同的配置文件，key value存储区等读取数据。每个都可以从不同的配置文件、键值存储等中读取。viper包支持的所有功能都被镜像为viper实例的方法。</p>
<p>例如：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>x := viper.<span style="color:#666;font-weight:bold;font-style:italic">New</span>()
</span></span><span style="display:flex;"><span>y := viper.<span style="color:#666;font-weight:bold;font-style:italic">New</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x.<span style="color:#666;font-weight:bold;font-style:italic">SetDefault</span>(<span style="color:#666;font-style:italic">&#34;ContentDir&#34;</span>, <span style="color:#666;font-style:italic">&#34;content&#34;</span>)
</span></span><span style="display:flex;"><span>y.<span style="color:#666;font-weight:bold;font-style:italic">SetDefault</span>(<span style="color:#666;font-style:italic">&#34;ContentDir&#34;</span>, <span style="color:#666;font-style:italic">&#34;foobar&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic">//...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>当使用多个viper实例时，由用户来管理不同的viper实例。</p>
<h2 id="使用viper示例">使用Viper示例</h2>
<p>假设我们的项目现在有一个<code>./conf/config.yaml</code>配置文件，内容如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>port: 8123
</span></span><span style="display:flex;"><span>version: <span style="color:#666;font-style:italic">&#34;v1.2.3&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来通过示例代码演示两种在项目中使用<code>viper</code>管理项目配置信息的方式。</p>
<h3 id="直接使用viper管理配置">直接使用viper管理配置</h3>
<p>这里用一个demo演示如何在gin框架搭建的web项目中使用<code>viper</code>，使用viper加载配置文件中的信息，并在代码中直接使用<code>viper.GetXXX()</code>方法获取对应的配置值。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;github.com/spf13/viper&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> <span style="color:#666;font-weight:bold;font-style:italic">main</span>() {
</span></span><span style="display:flex;"><span>	viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigFile</span>(<span style="color:#666;font-style:italic">&#34;config.yaml&#34;</span>) <span style="color:#888;font-style:italic">// 指定配置文件
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	viper.<span style="color:#666;font-weight:bold;font-style:italic">AddConfigPath</span>(<span style="color:#666;font-style:italic">&#34;./conf/&#34;</span>)     <span style="color:#888;font-style:italic">// 指定查找配置文件的路径
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	err := viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadInConfig</span>()        <span style="color:#888;font-style:italic">// 读取配置信息
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	<span style="font-weight:bold">if</span> err != <span style="font-weight:bold">nil</span> {                    <span style="color:#888;font-style:italic">// 读取配置信息失败
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>		<span style="font-weight:bold;font-style:italic">panic</span>(fmt.<span style="color:#666;font-weight:bold;font-style:italic">Errorf</span>(<span style="color:#666;font-style:italic">&#34;Fatal error config file: %s \n&#34;</span>, err))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#888;font-style:italic">// 监控配置文件变化
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	viper.<span style="color:#666;font-weight:bold;font-style:italic">WatchConfig</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	r := gin.<span style="color:#666;font-weight:bold;font-style:italic">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#888;font-style:italic">// 访问/version的返回值会随配置文件的变化而变化
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	r.<span style="color:#666;font-weight:bold;font-style:italic">GET</span>(<span style="color:#666;font-style:italic">&#34;/version&#34;</span>, <span style="font-weight:bold;font-style:italic">func</span>(c *gin.Context) {
</span></span><span style="display:flex;"><span>		c.<span style="color:#666;font-weight:bold;font-style:italic">String</span>(http.StatusOK, viper.<span style="color:#666;font-weight:bold;font-style:italic">GetString</span>(<span style="color:#666;font-style:italic">&#34;version&#34;</span>))
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">if</span> err := r.<span style="color:#666;font-weight:bold;font-style:italic">Run</span>(
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#666;font-weight:bold;font-style:italic">Sprintf</span>(<span style="color:#666;font-style:italic">&#34;:%d&#34;</span>, viper.<span style="color:#666;font-weight:bold;font-style:italic">GetInt</span>(<span style="color:#666;font-style:italic">&#34;port&#34;</span>))); err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用结构体变量保存配置信息">使用结构体变量保存配置信息</h3>
<p>除了上面的用法外，我们还可以在项目中定义与配置文件对应的结构体，<code>viper</code>加载完配置信息后使用结构体变量保存配置信息。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="font-weight:bold">package</span> main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;github.com/fsnotify/fsnotify&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#666;font-style:italic">&#34;github.com/spf13/viper&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">type</span> Config <span style="font-weight:bold;font-style:italic">struct</span> {
</span></span><span style="display:flex;"><span>	Port    <span style="font-weight:bold">int</span>    <span style="color:#666;font-style:italic">`mapstructure:&#34;port&#34;`</span>
</span></span><span style="display:flex;"><span>	Version <span style="font-weight:bold">string</span> <span style="color:#666;font-style:italic">`mapstructure:&#34;version&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">var</span> Conf = <span style="font-weight:bold;font-style:italic">new</span>(Config)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;font-style:italic">func</span> <span style="color:#666;font-weight:bold;font-style:italic">main</span>() {
</span></span><span style="display:flex;"><span>	viper.<span style="color:#666;font-weight:bold;font-style:italic">SetConfigFile</span>(<span style="color:#666;font-style:italic">&#34;./conf/config.yaml&#34;</span>) <span style="color:#888;font-style:italic">// 指定配置文件路径
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	err := viper.<span style="color:#666;font-weight:bold;font-style:italic">ReadInConfig</span>()               <span style="color:#888;font-style:italic">// 读取配置信息
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	<span style="font-weight:bold">if</span> err != <span style="font-weight:bold">nil</span> {                           <span style="color:#888;font-style:italic">// 读取配置信息失败
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>		<span style="font-weight:bold;font-style:italic">panic</span>(fmt.<span style="color:#666;font-weight:bold;font-style:italic">Errorf</span>(<span style="color:#666;font-style:italic">&#34;Fatal error config file: %s \n&#34;</span>, err))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#888;font-style:italic">// 将读取的配置信息保存至全局变量Conf
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	<span style="font-weight:bold">if</span> err := viper.<span style="color:#666;font-weight:bold;font-style:italic">Unmarshal</span>(Conf); err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold;font-style:italic">panic</span>(fmt.<span style="color:#666;font-weight:bold;font-style:italic">Errorf</span>(<span style="color:#666;font-style:italic">&#34;unmarshal conf failed, err:%s \n&#34;</span>, err))
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#888;font-style:italic">// 监控配置文件变化
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	viper.<span style="color:#666;font-weight:bold;font-style:italic">WatchConfig</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#888;font-style:italic">// 注意！！！配置文件发生变化后要同步到全局变量Conf
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	viper.<span style="color:#666;font-weight:bold;font-style:italic">OnConfigChange</span>(<span style="font-weight:bold;font-style:italic">func</span>(in fsnotify.Event) {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#666;font-weight:bold;font-style:italic">Println</span>(<span style="color:#666;font-style:italic">&#34;夭寿啦~配置文件被人修改啦...&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold">if</span> err := viper.<span style="color:#666;font-weight:bold;font-style:italic">Unmarshal</span>(Conf); err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="font-weight:bold;font-style:italic">panic</span>(fmt.<span style="color:#666;font-weight:bold;font-style:italic">Errorf</span>(<span style="color:#666;font-style:italic">&#34;unmarshal conf failed, err:%s \n&#34;</span>, err))
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	r := gin.<span style="color:#666;font-weight:bold;font-style:italic">Default</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#888;font-style:italic">// 访问/version的返回值会随配置文件的变化而变化
</span></span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"></span>	r.<span style="color:#666;font-weight:bold;font-style:italic">GET</span>(<span style="color:#666;font-style:italic">&#34;/version&#34;</span>, <span style="font-weight:bold;font-style:italic">func</span>(c *gin.Context) {
</span></span><span style="display:flex;"><span>		c.<span style="color:#666;font-weight:bold;font-style:italic">String</span>(http.StatusOK, Conf.Version)
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="font-weight:bold">if</span> err := r.<span style="color:#666;font-weight:bold;font-style:italic">Run</span>(fmt.<span style="color:#666;font-weight:bold;font-style:italic">Sprintf</span>(<span style="color:#666;font-style:italic">&#34;:%d&#34;</span>, Conf.Port)); err != <span style="font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="参考链接">参考链接</h2>
<p><a href="https://github.com/spf13/viper/blob/master/README.md">https://github.com/spf13/viper/blob/master/README.md</a></p>
        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/Go/protobuf/">protobuf初识</a></li>
        
        <li><a href="/post/about_docker/">Docker的安装与使用</a></li>
        
        <li><a href="/post/Go/go_logrus/">第三方日志库logrus使用</a></li>
        
        <li><a href="/post/Go/go_etcd/">Go操作etcd</a></li>
        
        <li><a href="/post/Go/go_kafka/">Go操作Kafka</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/viper'>viper</a></li>
                
                <li><a href='/tags/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6%E5%92%8C%E6%8A%80%E5%B7%A7'>常用组件和技巧</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2022 <a href="https://blog.imw7.com/">魏奇的博客 By 魏奇</a>
        
        | <a rel="nofollow" target="_blank" href="http://beian.miit.gov.cn/">蜀ICP备2022000811号-1</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




    <script src='/js/douban.js'></script>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://blog.imw7.com/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://blog.imw7.com/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://blog.imw7.com/post/docker_guide/" title="Docker简易指南">Docker简易指南</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/Go/fastdfs/" title="FastDFS">FastDFS</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/mysql/" title="在CentOS7.x上安装MySQL8.0">在CentOS7.x上安装MySQL8.0</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/redis_on_centos/" title="CentOS与Redis">CentOS与Redis</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/ssh_upload_download/" title="ssh使用scp或rsync上传和下载文件">ssh使用scp或rsync上传和下载文件</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/http/" title="HTTP协议">HTTP协议</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/Go/project_struct/" title="一般项目的结构">一般项目的结构</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/Go/bcrypt/" title="密码加密">密码加密</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/Go/makefile/" title="为Go项目编写Makefile">为Go项目编写Makefile</a>
    </li>
    
    <li>
        <a href="https://blog.imw7.com/post/Go/go_micro/" title="go-micro">go-micro</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://blog.imw7.com/categories/Docker/">Docker (2)</a></li>
    
    <li><a href="https://blog.imw7.com/categories/Go/">Go (53)</a></li>
    
    <li><a href="https://blog.imw7.com/categories/Hexo/">Hexo (1)</a></li>
    
    <li><a href="https://blog.imw7.com/categories/git/">git (1)</a></li>
    
    <li><a href="https://blog.imw7.com/categories/%E5%85%B6%E4%BB%96/">其他 (1)</a></li>
    
    <li><a href="https://blog.imw7.com/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器 (3)</a></li>
    
    <li><a href="https://blog.imw7.com/categories/%E7%AE%97%E6%B3%95/">算法 (1)</a></li>
    
    <li><a href="https://blog.imw7.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络 (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://blog.imw7.com/tags/Bcrypt/">Bcrypt</a>
    
    <a href="https://blog.imw7.com/tags/Cookie/">Cookie</a>
    
    <a href="https://blog.imw7.com/tags/Docker/">Docker</a>
    
    <a href="https://blog.imw7.com/tags/ES/">ES</a>
    
    <a href="https://blog.imw7.com/tags/Firefox/">Firefox</a>
    
    <a href="https://blog.imw7.com/tags/GMP/">GMP</a>
    
    <a href="https://blog.imw7.com/tags/HDMI/">HDMI</a>
    
    <a href="https://blog.imw7.com/tags/Hexo/">Hexo</a>
    
    <a href="https://blog.imw7.com/tags/Kafka/">Kafka</a>
    
    <a href="https://blog.imw7.com/tags/Kibana/">Kibana</a>
    
    <a href="https://blog.imw7.com/tags/Linux/">Linux</a>
    
    <a href="https://blog.imw7.com/tags/MongoDB/">MongoDB</a>
    
    <a href="https://blog.imw7.com/tags/MySQL/">MySQL</a>
    
    <a href="https://blog.imw7.com/tags/NSQ/">NSQ</a>
    
    <a href="https://blog.imw7.com/tags/Redis/">Redis</a>
    
    <a href="https://blog.imw7.com/tags/Session/">Session</a>
    
    <a href="https://blog.imw7.com/tags/Ubuntu/">Ubuntu</a>
    
    <a href="https://blog.imw7.com/tags/VS-Code/">VS Code</a>
    
    <a href="https://blog.imw7.com/tags/Web%E5%BC%80%E5%8F%91/">Web开发</a>
    
    <a href="https://blog.imw7.com/tags/centos/">centos</a>
    
    <a href="https://blog.imw7.com/tags/channel/">channel</a>
    
    <a href="https://blog.imw7.com/tags/context/">context</a>
    
    <a href="https://blog.imw7.com/tags/etcd/">etcd</a>
    
    <a href="https://blog.imw7.com/tags/fastdfs/">fastdfs</a>
    
    <a href="https://blog.imw7.com/tags/flag/">flag</a>
    
    <a href="https://blog.imw7.com/tags/fmt/">fmt</a>
    
    <a href="https://blog.imw7.com/tags/gin/">gin</a>
    
    <a href="https://blog.imw7.com/tags/git/">git</a>
    
    <a href="https://blog.imw7.com/tags/go-micro/">go-micro</a>
    
    <a href="https://blog.imw7.com/tags/go-module/">go module</a>
    
    <a href="https://blog.imw7.com/tags/goroutine/">goroutine</a>
    
    <a href="https://blog.imw7.com/tags/grpc/">grpc</a>
    
    <a href="https://blog.imw7.com/tags/http/">http</a>
    
    <a href="https://blog.imw7.com/tags/interface/">interface</a>
    
    <a href="https://blog.imw7.com/tags/iota/">iota</a>
    
    <a href="https://blog.imw7.com/tags/jwt/">jwt</a>
    
    <a href="https://blog.imw7.com/tags/log/">log</a>
    
    <a href="https://blog.imw7.com/tags/logrus/">logrus</a>
    
    <a href="https://blog.imw7.com/tags/makefile/">makefile</a>
    
    <a href="https://blog.imw7.com/tags/map/">map</a>
    
    <a href="https://blog.imw7.com/tags/MySQL/">MySQL</a>
    
    <a href="https://blog.imw7.com/tags/net/http/">net/http</a>
    
    <a href="https://blog.imw7.com/tags/os.Args/">os.Args</a>
    
    <a href="https://blog.imw7.com/tags/package/">package</a>
    
    <a href="https://blog.imw7.com/tags/pprof/">pprof</a>
    
    <a href="https://blog.imw7.com/tags/protobuf/">protobuf</a>
    
    <a href="https://blog.imw7.com/tags/sarama/">sarama</a>
    
    <a href="https://blog.imw7.com/tags/sqlx/">sqlx</a>
    
    <a href="https://blog.imw7.com/tags/ssh/">ssh</a>
    
    <a href="https://blog.imw7.com/tags/strconv/">strconv</a>
    
    <a href="https://blog.imw7.com/tags/tailf/">tailf</a>
    
    <a href="https://blog.imw7.com/tags/template/">template</a>
    
    <a href="https://blog.imw7.com/tags/time/">time</a>
    
    <a href="https://blog.imw7.com/tags/viper/">viper</a>
    
    <a href="https://blog.imw7.com/tags/yilia/">yilia</a>
    
    <a href="https://blog.imw7.com/tags/%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/">上传文件</a>
    
    <a href="https://blog.imw7.com/tags/%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86/">依赖管理</a>
    
    <a href="https://blog.imw7.com/tags/%E5%87%BD%E6%95%B0/">函数</a>
    
    <a href="https://blog.imw7.com/tags/%E5%88%87%E7%89%87/">切片</a>
    
    <a href="https://blog.imw7.com/tags/%E5%8F%8D%E5%B0%84/">反射</a>
    
    <a href="https://blog.imw7.com/tags/%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F/">变量和常量</a>
    
    <a href="https://blog.imw7.com/tags/%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">基本数据类型</a>
    
    <a href="https://blog.imw7.com/tags/%E5%9F%BA%E7%A1%80/">基础</a>
    
    <a href="https://blog.imw7.com/tags/%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/">密码加密</a>
    
    <a href="https://blog.imw7.com/tags/%E5%AF%BC%E5%85%A5%E6%9C%AC%E5%9C%B0%E5%8C%85/">导入本地包</a>
    
    <a href="https://blog.imw7.com/tags/%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6%E5%92%8C%E7%BB%84%E4%BB%B6/">常用框架和组件</a>
    
    <a href="https://blog.imw7.com/tags/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6%E4%B8%8E%E6%8A%80%E5%B7%A7/">常用组件与技巧</a>
    
    <a href="https://blog.imw7.com/tags/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6%E5%92%8C%E6%8A%80%E5%B7%A7/">常用组件和技巧</a>
    
    <a href="https://blog.imw7.com/tags/%E5%B9%B6%E5%8F%91/">并发</a>
    
    <a href="https://blog.imw7.com/tags/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/">开发环境准备</a>
    
    <a href="https://blog.imw7.com/tags/%E5%BC%82%E6%88%96/">异或</a>
    
    <a href="https://blog.imw7.com/tags/%E6%8C%87%E9%92%88/">指针</a>
    
    <a href="https://blog.imw7.com/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">排序算法</a>
    
    <a href="https://blog.imw7.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
    
    <a href="https://blog.imw7.com/tags/%E6%95%B0%E7%BB%84/">数组</a>
    
    <a href="https://blog.imw7.com/tags/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">文件操作</a>
    
    <a href="https://blog.imw7.com/tags/%E6%A0%87%E5%87%86%E5%BA%93/">标准库</a>
    
    <a href="https://blog.imw7.com/tags/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/">流程控制</a>
    
    <a href="https://blog.imw7.com/tags/%E6%B5%8B%E8%AF%95/">测试</a>
    
    <a href="https://blog.imw7.com/tags/%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80/">类型断言</a>
    
    <a href="https://blog.imw7.com/tags/%E7%BB%93%E6%9E%84%E4%BD%93/">结构体</a>
    
    <a href="https://blog.imw7.com/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">网络编程</a>
    
    <a href="https://blog.imw7.com/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91/">跨平台编译</a>
    
    <a href="https://blog.imw7.com/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/">运算符</a>
    
    <a href="https://blog.imw7.com/tags/%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/">项目结构</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.imw7.com/" title="魏奇的博客">魏奇的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://blog.imw7.com/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>